echo "Downloading files..."

curl https://git.yingxuan.io/yx/init-d/-/raw/master/docker-swarm/env.sh > env.sh
curl https://git.yingxuan.io/yx/init-d/-/raw/master/docker-swarm/traefik.yml > traefik.yml
curl https://git.yingxuan.io/yx/init-d/-/raw/master/docker-swarm/portainer-agent-stack.yml > portainer-agent-stack.yml

chmod +x env.sh

exec ./env.sh

echo "Deploying traefik..."
docker stack deploy -c traefik.yml traefik

echo "Deploying portainer..."
docker stack deploy -c portainer-agent-stack.yml portainer
